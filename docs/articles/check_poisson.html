<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checking the Applicability of a Poisson Test â€¢ simaerep</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Checking the Applicability of a Poisson Test">
<meta property="og:description" content="simaerep">
<meta property="og:image" content="https://openpharma.github.io/simaerep/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-123997499-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123997499-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simaerep</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/intro.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/usability_limits.html">Address Usability Limits of the Bootstrap Method</a>
    </li>
    <li>
      <a href="../articles/check_poisson.html">Checking the Applicability of a Poisson Test</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/openpharma/simaerep/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Checking the Applicability of a Poisson Test</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/simaerep/blob/master/vignettes/check_poisson.Rmd"><code>vignettes/check_poisson.Rmd</code></a></small>
      <div class="hidden name"><code>check_poisson.Rmd</code></div>

    </div>

    
    
<div id="load" class="section level1">
<h1 class="hasAnchor">
<a href="#load" class="anchor"></a>Load</h1>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span>( <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>) )
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span>( <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">knitr</span>) )
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span>( <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">furrr</span>) )
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span>( <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">future</span>) )
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span>( <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">simaerep</span>) )</pre></body></html></div>
</div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Perhaps there might be scenarios in which one prefers to use a parametric test vs the non-parametric bootstrap-based resampling method to calculate AE under-reporting. <code>simaerep</code> provides a function that does bootstrap resampling of the entire study preserving the actual site parameters such as number of patients and visit_med75.</p>
<p>Using this pool we can check whether the p-values calculated by <code><a href="https://rdrr.io/r/stats/poisson.test.html">poisson.test()</a></code> represent accurate probabilities.</p>
<div id="test-data-and-standard-processing" class="section level2">
<h2 class="hasAnchor">
<a href="#test-data-and-standard-processing" class="anchor"></a>Test Data and Standard Processing</h2>
<p>We simulate three studies with varying ae per visit rate and then use all functions we already <a href="https://openpharma.github.io/simaerep/articles/intro.html">introduced</a>.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">df_visit1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sim_test_data_study.html">sim_test_data_study</a></span>(
  <span class="kw">n_pat</span> <span class="kw">=</span> <span class="fl">1000</span>,
  <span class="kw">n_sites</span> <span class="kw">=</span> <span class="fl">100</span>,
  <span class="kw">frac_site_with_ur</span> <span class="kw">=</span> <span class="fl">0.2</span>,
  <span class="kw">ur_rate</span> <span class="kw">=</span> <span class="fl">0.5</span>,
  <span class="kw">max_visit_mean</span> <span class="kw">=</span> <span class="fl">20</span>,
  <span class="kw">max_visit_sd</span> <span class="kw">=</span> <span class="fl">4</span>,
  <span class="kw">ae_per_visit_mean</span> <span class="kw">=</span> <span class="fl">0.5</span>
)

<span class="no">df_visit1</span>$<span class="no">study_id</span> <span class="kw">&lt;-</span> <span class="st">"ae_per_visit: 0.5"</span>

<span class="no">df_visit2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sim_test_data_study.html">sim_test_data_study</a></span>(
  <span class="kw">n_pat</span> <span class="kw">=</span> <span class="fl">1000</span>,
  <span class="kw">n_sites</span> <span class="kw">=</span> <span class="fl">100</span>,
  <span class="kw">frac_site_with_ur</span> <span class="kw">=</span> <span class="fl">0.2</span>,
  <span class="kw">ur_rate</span> <span class="kw">=</span> <span class="fl">0.5</span>,
  <span class="kw">max_visit_mean</span> <span class="kw">=</span> <span class="fl">20</span>,
  <span class="kw">max_visit_sd</span> <span class="kw">=</span> <span class="fl">4</span>,
  <span class="kw">ae_per_visit_mean</span> <span class="kw">=</span> <span class="fl">0.2</span>
)

<span class="no">df_visit2</span>$<span class="no">study_id</span> <span class="kw">&lt;-</span> <span class="st">"ae_per_visit: 0.2"</span>

<span class="no">df_visit3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sim_test_data_study.html">sim_test_data_study</a></span>(
  <span class="kw">n_pat</span> <span class="kw">=</span> <span class="fl">1000</span>,
  <span class="kw">n_sites</span> <span class="kw">=</span> <span class="fl">100</span>,
  <span class="kw">frac_site_with_ur</span> <span class="kw">=</span> <span class="fl">0.2</span>,
  <span class="kw">ur_rate</span> <span class="kw">=</span> <span class="fl">0.5</span>,
  <span class="kw">max_visit_mean</span> <span class="kw">=</span> <span class="fl">20</span>,
  <span class="kw">max_visit_sd</span> <span class="kw">=</span> <span class="fl">4</span>,
  <span class="kw">ae_per_visit_mean</span> <span class="kw">=</span> <span class="fl">0.05</span>
)

<span class="no">df_visit3</span>$<span class="no">study_id</span> <span class="kw">&lt;-</span> <span class="st">"ae_per_visit: 0.05"</span>

<span class="no">df_visit</span> <span class="kw">&lt;-</span> <span class="fu">bind_rows</span>(<span class="no">df_visit1</span>, <span class="no">df_visit2</span>, <span class="no">df_visit3</span>)

<span class="no">df_site</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/site_aggr.html">site_aggr</a></span>(<span class="no">df_visit</span>)

<span class="no">df_sim_sites</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sim_sites.html">sim_sites</a></span>(<span class="no">df_site</span>, <span class="no">df_visit</span>)

<span class="no">df_visit</span></pre></body></html></div>
<pre><code>## # A tibble: 58,791 x 9
##    patnum site_number is_ur max_visit_mean max_visit_sd ae_per_visit_meâ€¦ visit
##    &lt;chr&gt;  &lt;chr&gt;       &lt;lgl&gt;          &lt;dbl&gt;        &lt;dbl&gt;            &lt;dbl&gt; &lt;int&gt;
##  1 P0000â€¦ S0001       TRUE              20            4             0.25     1
##  2 P0000â€¦ S0001       TRUE              20            4             0.25     2
##  3 P0000â€¦ S0001       TRUE              20            4             0.25     3
##  4 P0000â€¦ S0001       TRUE              20            4             0.25     4
##  5 P0000â€¦ S0001       TRUE              20            4             0.25     5
##  6 P0000â€¦ S0001       TRUE              20            4             0.25     6
##  7 P0000â€¦ S0001       TRUE              20            4             0.25     7
##  8 P0000â€¦ S0001       TRUE              20            4             0.25     8
##  9 P0000â€¦ S0001       TRUE              20            4             0.25     9
## 10 P0000â€¦ S0001       TRUE              20            4             0.25    10
## # â€¦ with 58,781 more rows, and 2 more variables: n_ae &lt;int&gt;, study_id &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">df_site</span></pre></body></html></div>
<pre><code>## # A tibble: 300 x 6
##    study_id site_number n_patients visit_med75 n_pat_with_med75 mean_ae_site_meâ€¦
##    &lt;chr&gt;    &lt;chr&gt;            &lt;int&gt;       &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1 ae_per_â€¦ S0001               10          17                9             3.67
##  2 ae_per_â€¦ S0002               10          14                8             2.88
##  3 ae_per_â€¦ S0003               10          17                9             4.22
##  4 ae_per_â€¦ S0004               10          14                9             3.78
##  5 ae_per_â€¦ S0005               10          15                8             4.62
##  6 ae_per_â€¦ S0006               10          15                9             4.33
##  7 ae_per_â€¦ S0007               10          16                9             4.56
##  8 ae_per_â€¦ S0008               10          17                9             3.67
##  9 ae_per_â€¦ S0009               10          14                9             3.22
## 10 ae_per_â€¦ S0010               10          16                8             4.12
## # â€¦ with 290 more rows</code></pre>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">df_sim_sites</span></pre></body></html></div>
<pre><code>## # A tibble: 300 x 7
##    study_id site_number visit_med75 mean_ae_site_meâ€¦ mean_ae_study_mâ€¦    pval
##    &lt;chr&gt;    &lt;chr&gt;             &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;   &lt;dbl&gt;
##  1 ae_per_â€¦ S0001                16            0.556            0.696 0.839  
##  2 ae_per_â€¦ S0002                15            0                0.657 0.00557
##  3 ae_per_â€¦ S0003                16            0.4              0.698 0.339  
##  4 ae_per_â€¦ S0004                15            0.556            0.652 1      
##  5 ae_per_â€¦ S0005                13            0.5              0.572 1      
##  6 ae_per_â€¦ S0006                15            0.4              0.654 0.430  
##  7 ae_per_â€¦ S0007                15            0.333            0.654 0.300  
##  8 ae_per_â€¦ S0008                16            0.222            0.7   0.104  
##  9 ae_per_â€¦ S0009                14            0.111            0.607 0.0504 
## 10 ae_per_â€¦ S0010                14            0.3              0.606 0.302  
## # â€¦ with 290 more rows, and 1 more variable: prob_low &lt;dbl&gt;</code></pre>
</div>
<div id="simulate-studies" class="section level2">
<h2 class="hasAnchor">
<a href="#simulate-studies" class="anchor"></a>Simulate Studies</h2>
<p><a href="https://openpharma.github.io/simaerep/reference/sim_studies.html">sim_studies()</a> reproduces each study a hundred times using bootstrap resampling maintaining the number of patients and the visit_med75 of each site.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">1</span>)

<span class="no">df_sim_studies</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sim_studies.html">sim_studies</a></span>(<span class="no">df_visit</span>, <span class="no">df_site</span>,
                              <span class="kw">r</span> <span class="kw">=</span> <span class="fl">100</span>,
                              <span class="kw">parallel</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                              <span class="kw">poisson_test</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                              <span class="kw">prob_lower</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                              <span class="kw">.progress</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="no">df_sim_studies</span></pre></body></html></div>
<pre><code>## # A tibble: 30,000 x 8
##        r study_id site_number visit_med75 n_pat_with_med75 n_pat_study  pval
##    &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;             &lt;dbl&gt;            &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
##  1     1 ae_per_â€¦ S0001                17                9         787 0.589
##  2     1 ae_per_â€¦ S0002                14                8         926 1    
##  3     1 ae_per_â€¦ S0003                17                9         787 1    
##  4     1 ae_per_â€¦ S0004                14                9         925 0.501
##  5     1 ae_per_â€¦ S0005                15                8         893 0.639
##  6     1 ae_per_â€¦ S0006                15                9         892 1    
##  7     1 ae_per_â€¦ S0007                16                9         845 0.138
##  8     1 ae_per_â€¦ S0008                17                9         787 0.811
##  9     1 ae_per_â€¦ S0009                14                9         925 0.431
## 10     1 ae_per_â€¦ S0010                16                8         846 1    
## # â€¦ with 29,990 more rows, and 1 more variable: prob_low &lt;dbl&gt;</code></pre>
</div>
<div id="check-p-value-probabilities" class="section level2">
<h2 class="hasAnchor">
<a href="#check-p-value-probabilities" class="anchor"></a>Check p-value Probabilities</h2>
<p><a href="https://openpharma.github.io/simaerep/reference/get_ecd_values.html">get_ecd_values()</a> uses the p-value distribution in the dataframe returned from sim_studies() to train a empirical cumulative distribution function for each study which is then used to calculate the probability of a specific p-value or lower from the poisson.test p-value returned from sim_sites()</p>
<p>Note: Dots on the edge of the graph that are cut off have zero value for the corresponding axis.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">df_check_pval</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_ecd_values.html">get_ecd_values</a></span>(<span class="no">df_sim_studies</span>, <span class="no">df_sim_sites</span>, <span class="kw">val_str</span> <span class="kw">=</span> <span class="st">"pval"</span>)

<span class="no">df_check_pval</span></pre></body></html></div>
<pre><code>## # A tibble: 300 x 8
##    study_id site_number visit_med75 mean_ae_site_meâ€¦ mean_ae_study_mâ€¦    pval
##    &lt;chr&gt;    &lt;chr&gt;             &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;   &lt;dbl&gt;
##  1 ae_per_â€¦ S0001                16            0.556            0.696 0.839  
##  2 ae_per_â€¦ S0002                15            0                0.657 0.00557
##  3 ae_per_â€¦ S0003                16            0.4              0.698 0.339  
##  4 ae_per_â€¦ S0004                15            0.556            0.652 1      
##  5 ae_per_â€¦ S0005                13            0.5              0.572 1      
##  6 ae_per_â€¦ S0006                15            0.4              0.654 0.430  
##  7 ae_per_â€¦ S0007                15            0.333            0.654 0.300  
##  8 ae_per_â€¦ S0008                16            0.222            0.7   0.104  
##  9 ae_per_â€¦ S0009                14            0.111            0.607 0.0504 
## 10 ae_per_â€¦ S0010                14            0.3              0.606 0.302  
## # â€¦ with 290 more rows, and 2 more variables: prob_low &lt;dbl&gt;, pval_ecd &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">df_check_pval</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">pval</span>, <span class="kw">base</span> <span class="kw">=</span> <span class="fl">10</span>), <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">pval_ecd</span>, <span class="kw">base</span> <span class="kw">=</span> <span class="fl">10</span>))) +
    <span class="fu">geom_point</span>(<span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>) +
    <span class="fu">facet_wrap</span>(~ <span class="no">study_id</span>) +
    <span class="fu">geom_abline</span>(<span class="kw">slope</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">linetype</span> <span class="kw">=</span> <span class="fl">2</span>) +
    <span class="fu">coord_cartesian</span>( <span class="kw">xlim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">5</span>,<span class="fl">0</span>), <span class="kw">ylim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">5</span>,<span class="fl">0</span>) ) +
    <span class="fu">theme</span>(<span class="kw">aspect.ratio</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<p><img src="check_poisson_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>We can see that the p-values from poisson.test (x-axis) more or less match the probability with which they are represented in the resampled studies (y-axis), but there is some skewness to their relationship.</p>
</div>
<div id="perform-same-check-on-bootstrapped-probabilities" class="section level2">
<h2 class="hasAnchor">
<a href="#perform-same-check-on-bootstrapped-probabilities" class="anchor"></a>Perform Same Check on Bootstrapped Probabilities</h2>
<p>Note: Dots on the edge of the graph that are cut off have zero value for the corresponding axis. For the tie simulations using 1000 repeats the smallest value greater zero we get for prob_low is 0.001 (1e-3).</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">df_check_prob</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_ecd_values.html">get_ecd_values</a></span>(<span class="no">df_sim_studies</span>, <span class="no">df_sim_sites</span>, <span class="kw">val_str</span> <span class="kw">=</span> <span class="st">"prob_low"</span>)

<span class="no">df_check_prob</span></pre></body></html></div>
<pre><code>## # A tibble: 300 x 8
##    study_id site_number visit_med75 mean_ae_site_meâ€¦ mean_ae_study_mâ€¦    pval
##    &lt;chr&gt;    &lt;chr&gt;             &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;   &lt;dbl&gt;
##  1 ae_per_â€¦ S0001                16            0.556            0.696 0.839  
##  2 ae_per_â€¦ S0002                15            0                0.657 0.00557
##  3 ae_per_â€¦ S0003                16            0.4              0.698 0.339  
##  4 ae_per_â€¦ S0004                15            0.556            0.652 1      
##  5 ae_per_â€¦ S0005                13            0.5              0.572 1      
##  6 ae_per_â€¦ S0006                15            0.4              0.654 0.430  
##  7 ae_per_â€¦ S0007                15            0.333            0.654 0.300  
##  8 ae_per_â€¦ S0008                16            0.222            0.7   0.104  
##  9 ae_per_â€¦ S0009                14            0.111            0.607 0.0504 
## 10 ae_per_â€¦ S0010                14            0.3              0.606 0.302  
## # â€¦ with 290 more rows, and 2 more variables: prob_low &lt;dbl&gt;,
## #   prob_low_ecd &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">df_check_prob</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">prob_low</span>, <span class="kw">base</span> <span class="kw">=</span> <span class="fl">10</span>), <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">prob_low_ecd</span>, <span class="kw">base</span> <span class="kw">=</span> <span class="fl">10</span>))) +
    <span class="fu">geom_point</span>(<span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>) +
    <span class="fu">facet_wrap</span>(~ <span class="no">study_id</span>) +
    <span class="fu">geom_abline</span>(<span class="kw">slope</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">linetype</span> <span class="kw">=</span> <span class="fl">2</span>) +
    <span class="fu">coord_cartesian</span>( <span class="kw">xlim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">5</span>,<span class="fl">0</span>), <span class="kw">ylim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">5</span>,<span class="fl">0</span>) ) +
    <span class="fu">theme</span>(<span class="kw">aspect.ratio</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<p><img src="check_poisson_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>Here we see that the probabilities from the site simulations (x-axis) perfectly match probability with which they are represented in the resampled studies (y-axis).</p>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h2>
<p>We see that the bootstrap method gives us more accurate probabilities than the p-values derived from poisson.test even though the AE generation in the sample data follows a strict poisson process. For real clinical trial data with different types of studies for which it is not clear whether AE generation is truly based on a pure poisson process we recommend to use the bootstrap method. If poisson.test shall be used we recommend checking the applicability as we just demonstrated on clinical data set.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Bjoern Koneswarakantha.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
